<!DOCTYPE html>
<html class="writer-html5" lang="zh-TW" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>快速入門 &mdash; easy_configer v2.5.5 說明文件</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/custom.css" type="text/css" />
      <link rel="stylesheet" href="_static/fonts.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script src="_static/translations.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜尋" href="search.html" />
    <link rel="next" title="常用參考資訊" href="Usage.html" />
    <link rel="prev" title="下載教學" href="Installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            easy_configer
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" aria-label="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <p class="caption" role="heading"><span class="caption-text">內容目錄</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="About.html">關於此專案</a></li>
<li class="toctree-l1"><a class="reference internal" href="Installation.html">下載教學</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">快速入門</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#config-file">撰寫 config file 的快速上手範例 🥂</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Usage.html">常用參考資訊</a></li>
<li class="toctree-l1"><a class="reference internal" href="Metainfo.html">套件相關資訊</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API 文件</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api_Configer.html">Configer</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_IO_Converter.html">IO_Converter</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_Container.html">utils.Container</a></li>
<li class="toctree-l1"><a class="reference internal" href="api_Type_Convertor.html">utils.Type_Convertor</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">easy_configer</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">快速入門</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Quick.rst.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="id1">
<h1>快速入門<a class="headerlink" href="#id1" title="本標頭的永久連結"></a></h1>
<section id="config-file">
<h2>撰寫 config file 的快速上手範例 🥂<a class="headerlink" href="#config-file" title="本標頭的永久連結"></a></h2>
<p>讓我們假設在 Jupyter Notebook 中有一個用於開發環境的 easy_config。我們想要定義一些變量來配置一個簡單的數學計算。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># config 字串</span>
<span class="n">cfg_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">title = &#39;math calculation&#39;@str</span>
<span class="s1">coef = 1e-3@float</span>
<span class="s1">with_intercept = True@bool</span>
<span class="s1">intercept = 3@int</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="c1"># 看起來不錯, 讓我們取得 config!</span>
<span class="kn">from</span> <span class="nn">easy_configer.Configer</span> <span class="kn">import</span> <span class="n">Configer</span>
<span class="n">cfg</span> <span class="o">=</span> <span class="n">Configer</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;math calculation config!&quot;</span><span class="p">,</span> <span class="n">cmd_args</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">cfg_from_str</span><span class="p">(</span><span class="n">cfg_str</span><span class="p">)</span>

<span class="c1"># 喔.. 且慢, 我們可以讓它變得更簡單嗎 ?</span>
<span class="n">ez_cfg_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1"># opps.. let&#39;s change some value</span>
<span class="s1">title = &#39;linear equation&#39;</span>
<span class="s1">coef = 15</span>
<span class="s1">&#39;&#39;&#39;</span>
<span class="c1"># 請留意 : 每次我們加載 config, 具有同樣變數名稱的參數將被新加載的 config 複寫!!</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">cfg_from_str</span><span class="p">(</span><span class="n">ez_cfg_str</span><span class="p">)</span>

<span class="n">lin_equ</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">coef</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">cfg</span><span class="o">.</span><span class="n">intercept</span> <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">with_intercept</span> <span class="k">else</span> <span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">coef</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">15</span>
<span class="nb">print</span><span class="p">(</span> <span class="sa">f</span><span class="s2">&quot;Linear equation with x=</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="w"> </span><span class="n">lin_equ</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">)</span>
</pre></div>
</div>
<blockquote>
<div><p>如果你想覆蓋先前的組態配置，而呼叫了兩次 <code class="docutils literal notranslate"><span class="pre">cfg.cfg_from_str</span></code> 並設置 <code class="docutils literal notranslate"><span class="pre">allow_overwrite=True</span></code> 旗標，這雖方便卻不是推薦的方法。
在 easy-configer 中，我們提供了兩種方法來做到這一點。標準方法是 聲明兩個配置並應用配置合併 (config merging) 方法來獲取更新的配置。
另一種方法類似於 omegaconf 以動態方式導入子配置(sub-config)，不過你仍然需要在 <code class="docutils literal notranslate"><span class="pre">cfg.cfg_from_ini</span></code> 中設置 <code class="docutils literal notranslate"><span class="pre">allow_overwrite=True</span></code> 旗標。</p>
</div></blockquote>
<p>雖然在 Python 中編寫字串組態非常方便，但它只適用於較小規模的項目。
在較大型的項目中，我們可能會編寫一個配置文件來控制程序，使得配置更容易追蹤、檢查和調試。在這裡，我們首先在工作目錄中準備一個名為 <code class="docutils literal notranslate"><span class="pre">test_cfg.ini</span></code> 的配置文件，並概述我們如何在chatbot應用中使用這個組態。</p>
<p>在 easy-configer 中，配置有兩種類型的參數：扁平參數和層級參數。你會發現，扁平參數直接放置在配置中，並不屬於任何特定的區段 (即位於第一層)。
相對地，層級參數會被放置在區段中（例如 <code class="docutils literal notranslate"><span class="pre">[db_setup]</span></code>），並且可以有任意深度，區段下的參數會被一個容器 (<code class="docutils literal notranslate"><span class="pre">easy_configer.utils.Container.AttributeDict</span></code>) 包裹，這個容器類似於 Python 中的 dict。</p>
<p>為了在嵌套區段中形成層級參數，我們採用了類似 toml 的語法來描述嵌套區段（例如 <code class="docutils literal notranslate"><span class="pre">[bknd_srv.mod_params]</span></code> 屬於 <code class="docutils literal notranslate"><span class="pre">[bknd_srv]</span></code> 父區段內的子組態）。
嵌套區段中的參數也會被嵌套的 <code class="docutils literal notranslate"><span class="pre">AttributeDict</span></code> 包裹。此外，你可以使用簡單的 點操作符 (dot-operator) 來訪問各種參數，但我們仍然建議你像純 Python 字典一樣使用鍵字符串 (key-string)。</p>
<blockquote>
<div><p>請注意，推薦的訪問參數方式仍然是使用鍵字符串訪問 <code class="docutils literal notranslate"><span class="pre">cfger.args['#4$%-var']</span></code>，正如你所注意到的，
點操作符無法支持 <strong>醜陋的變數名稱</strong> （例如 <code class="docutils literal notranslate"><span class="pre">cfger.#4$%-var</span></code>，因為變數名在 Python 解釋器中是非法的）</p>
</div></blockquote>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># ./test_cfg.ini</span>
<span class="c1"># 以 &#39;#&#39; 開頭為 comment, 我們也支援 inline-comment了!</span>

<span class="c1"># 定義扁平參數 (flatten arguments) :</span>
<span class="na">serv_host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;127.0.0.1&#39;</span>
<span class="na">serv_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">9478@int</span><span class="w">    </span><span class="c1"># specific type is also allowed!!</span>
<span class="na">api_keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">{&#39;TW_REGION&#39;:&#39;SV92VS92N20&#39;, &#39;US_REGION&#39;:&#39;W92N8WN029N2&#39;}</span>

<span class="c1"># 定義階層化參數 :</span>
<span class="c1"># &#39;section&#39; 為存取字典值時所用的字串，並於以下定義 :</span>
<span class="k">[db_setup]</span>
<span class="w">    </span><span class="na">db_host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">${cfg.serv_host}:80@str</span>
<span class="w">    </span><span class="c1"># 請先於您的 bash 中執行 `export mongo_port=5566`, 我們支援對 os.env 的參數插值!</span>
<span class="w">    </span><span class="na">db_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">${env.mongo_port}</span>
<span class="w">    </span><span class="na">snap_shot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">True</span>

<span class="c1"># 接著我們為後端 server 定義 第二個 section..</span>
<span class="k">[bknd_srv]</span>
<span class="w">    </span><span class="na">load_8bit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">True</span>
<span class="w">    </span><span class="na">async_req</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">True</span>
<span class="w">    </span><span class="na">chat_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;inference&#39;</span>
<span class="w">    </span><span class="na">model_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;LlaMa2.0&#39;</span>
<span class="w">    </span><span class="k">[bknd_srv.mod_params]</span>
<span class="w">        </span><span class="na">log_hist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">False</span>
<span class="w">        </span><span class="na">tempeture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1e-4</span>
<span class="w">        </span><span class="na">model_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">${cfg.bknd_srv.chat_mode}</span><span class="w">  </span><span class="c1"># 階層化參數插值</span>
</pre></div>
</div>
<p><span class="raw-html-m2r"><br></span></p>
<p>現在，您可以通過在工作目錄中運行 <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">quick_start.py</span></code> 來啟動聊天機器人 (<em>quick_start.py 在您的工作目錄中</em>)!
當然，您也可以通過命令行使用 <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">quick_start.py</span> <span class="pre">serv_port=7894</span></code> 來覆蓋參數設置。</p>
<blockquote>
<div><p>請注意，藉由命令列(commendline)更新參數是允許的，但卻不允許覆蓋區段！
如果你 <strong>仍想</strong> 覆蓋區段，你需要設置標誌 <code class="docutils literal notranslate"><span class="pre">allow_overwrite=True</span></code>；但我們相當不建議，因為這代表當初組態所設定的區段配置有設計上的問題，
對於這種情形，我們寧可建議使用者 <strong>調整</strong> 區段配置的設計，而非用這種trick。</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>

<span class="c1"># main_block</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">easy_configer.Configer</span> <span class="kn">import</span> <span class="n">Configer</span>

    <span class="n">cfger</span> <span class="o">=</span> <span class="n">Configer</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;chat-bot configuration&quot;</span><span class="p">,</span> <span class="n">cmd_args</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># 我們先定義組態檔，然後嘗試加載它!</span>
    <span class="n">cfger</span><span class="o">.</span><span class="n">cfg_from_ini</span><span class="p">(</span><span class="s2">&quot;./test_cfg.ini&quot;</span><span class="p">)</span>

    <span class="c1"># 印出 Namespace, 它會印出所有扁平化參數 (first-level sections)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">cfger</span><span class="p">)</span>

    <span class="o">...</span> <span class="c1"># 建構 chat-bot 實例的程式碼 `Chat_server`</span>
    <span class="n">chat_serv</span> <span class="o">=</span> <span class="n">Chat_server</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">cfger</span><span class="o">.</span><span class="n">serv_host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">cfger</span><span class="o">.</span><span class="n">serv_port</span><span class="p">,</span> <span class="n">api_keys</span><span class="o">=</span><span class="n">cfger</span><span class="o">.</span><span class="n">api_keys</span><span class="p">)</span>

    <span class="o">...</span> <span class="c1"># 建構 mongo-db 實例的 `mongo_serv` 以紀錄歷史對話訊息..</span>
    <span class="n">mongo_serv</span><span class="o">.</span><span class="n">init_setup</span><span class="p">(</span> <span class="o">**</span><span class="n">cfger</span><span class="o">.</span><span class="n">db_setup</span> <span class="p">)</span>

    <span class="o">...</span> <span class="c1"># 加載 llm 模型實例 `Llama` ~</span>
    <span class="n">llm_mod</span> <span class="o">=</span> <span class="n">Llama</span><span class="p">(</span>
        <span class="n">ld_8bit</span><span class="o">=</span><span class="n">cfger</span><span class="o">.</span><span class="n">bknd_srv</span><span class="o">.</span><span class="n">load_8bit</span><span class="p">,</span>
        <span class="n">chat_mode</span><span class="o">=</span><span class="n">cfger</span><span class="o">.</span><span class="n">chat_mode</span><span class="p">,</span>
        <span class="n">model_type</span><span class="o">=</span><span class="n">cfger</span><span class="o">.</span><span class="n">model_type</span>
    <span class="p">)</span>
    <span class="c1"># 您可以藉由 dot 運算子存取 nested-dict ~</span>
    <span class="n">llm_mod</span><span class="o">.</span><span class="n">init_mod_param</span><span class="p">(</span> <span class="o">**</span><span class="n">cfger</span><span class="o">.</span><span class="n">bknd_srv</span><span class="o">.</span><span class="n">mod_params</span> <span class="p">)</span>

    <span class="c1"># 或您可以維持使用字串的字典存取風格 ~</span>
    <span class="k">if</span> <span class="n">cfger</span><span class="o">.</span><span class="n">bknd_srv</span><span class="p">[</span><span class="s1">&#39;async_req&#39;</span><span class="p">]:</span>
        <span class="n">chat_serv</span><span class="o">.</span><span class="n">chat_mod</span> <span class="o">=</span> <span class="n">llm_mod</span>
        <span class="n">chat_serv</span><span class="o">.</span><span class="n">hist_db</span> <span class="o">=</span> <span class="n">mongo_serv</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="o">...</span> <span class="c1"># 自行撰寫同步對話的程式碼..</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span> <span class="n">chat_serv</span><span class="o">.</span><span class="n">server_forever</span><span class="p">()</span> <span class="p">)</span>
</pre></div>
</div>
<p><span class="raw-html-m2r"><br></span></p>
<p><em>在接下來的章節中，將提供更詳細的教學…</em></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="页脚">
        <a href="Installation.html" class="btn btn-neutral float-left" title="下載教學" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="Usage.html" class="btn btn-neutral float-right" title="常用參考資訊" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版權所有 2024, JosefHuang。</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>